<div class="sp-container">
  <!-- <h2>Simple Sliding Puzzle</h2> -->

  <div
    class="sp-board"
    [class.solved]="isSolved()"
    [ngStyle]="dimensionStyle"
    aria-label="Simple sliding puzzle board"
  >
    <button
      class="sp-tile"
      *ngFor="let tile of tiles; let i = index"
      [class.empty]="tile === 0"
      [disabled]="tile === 0 || !canMove(i) || isSolved() || isPaused()"
      (click)="move(i)"
      [attr.aria-label]="tile === 0 ? 'Empty' : 'Tile ' + tile"
    >
      <span *ngIf="tile !== 0">{{ tile }}</span>
    </button>

    <!-- Solved overlay banner with backdrop inside the board -->
    <div class="sp-overlay" *ngIf="isSolved()" aria-live="polite">
      <div class="sp-overlay-card" role="dialog" aria-modal="true" aria-label="Puzzle solved">
        <h3>üéâ Puzzle Solved!</h3>
        <p>Solved in {{ moveCount }} moves, {{ formatTime(elapsedMs) }}.</p>
        <div *ngIf="isNewRecord.moves || isNewRecord.time" class="new-record-banner">
          <span *ngIf="isNewRecord.moves">ü•á New Best Moves!</span>
          <span *ngIf="isNewRecord.time">‚ö° New Best Time!</span>
        </div>
        <button #playAgainBtn (click)="reset()" autofocus title="Play Again (P or Space)">Play Again</button>
      </div>
    </div>

    <div class="sp-overlay" *ngIf="isPaused()" aria-live="polite">
      <div class="sp-overlay-card" role="dialog" aria-modal="true" aria-label="Game paused">
        <h3>‚è∏Ô∏è Game Paused</h3>
        <p>Resume to continue playing.</p>
        <button class="breathing resume-btn" (click)="resume()" autofocus title="Resume (Space)">Resume</button>
      </div>
    </div>
  </div>

  <div class="sp-side">
    <div class="sr-only" aria-live="polite">{{ statusMessage }}</div>
    <div class="sp-stats">
      <div class="div">
        <span
          >Moves: <strong>{{ moveCount }}</strong></span
        >
      </div>
      <div class="div">
        <span
          >Time: <strong class="mono">{{ formatTime(elapsedMs) }}</strong></span
        >
      </div>
    </div>

    <div class="sp-actions">
      <!-- Reset: only before game starts (full width when alone) -->
      <button *ngIf="!hasStarted" (click)="reset()">Shuffle / Reset</button>

      <!-- End: visible only after game starts -->
      <button *ngIf="hasStarted" (click)="end()" [disabled]="isSolved()" title="End (E)">End</button>

      <!-- Pause: visible when running -->
      <button *ngIf="hasStarted && isRunning" (click)="pause()" [disabled]="isSolved()" title="Pause (Space)">Pause</button>

      <!-- Resume: visible when paused -->
      <button *ngIf="hasStarted && isPaused()" (click)="resume()" [disabled]="isSolved()" title="Resume (Space)">Resume</button>
    </div>

    <div class="sp-size">
      <select
        aria-label="Board size"
        [(ngModel)]="size"
        (ngModelChange)="setSize($event)"
        [disabled]="hasStarted"
      >
        <option [value]="3">Board - 3√ó3</option>
        <option [value]="4">Board - 4√ó4</option>
        <option [value]="5">Board - 5√ó5</option>
      </select>
    </div>

    <div class="sp-leaderboard">
      <div class="sp-leaderboard-card card shadow-sm bg-transparent border-0">
        <div class="card-body">
          <h4 class="card-title text-center mb-3">üèÜ Best Records - {{ size }}√ó{{ size }}</h4>
          <div class="records" *ngIf="getCurrentRecord(); else noRecords">
            <div class="record-item d-flex justify-content-between align-items-center mb-3 p-2 bg-transparent border rounded">
              <div class="d-flex align-items-center" *ngIf="getCurrentRecord()?.bestMoves !== null">
                <span class="record-label fw-bold text-secondary me-2">Moves:</span>
                <span class="record-value d-flex align-items-center" [class.text-success]="isSolved() && isNewRecord.moves" [class.fw-bold]="isSolved() && isNewRecord.moves">
                  {{ getCurrentRecord()?.bestMoves }}
                  <span *ngIf="isSolved() && isNewRecord.moves" class="badge bg-success ms-2 animate__animated animate__pulse">NEW!</span>
                </span>
              </div>
              <div class="d-flex align-items-center" *ngIf="getCurrentRecord()?.bestTime !== null">
                <span class="record-label fw-bold text-secondary me-2">Time:</span>
                <span class="record-value d-flex align-items-center" [class.text-success]="isSolved() && isNewRecord.time" [class.fw-bold]="isSolved() && isNewRecord.time">
                  {{ formatTime(getCurrentRecord()?.bestTime || 0) }}
                  <span *ngIf="isSolved() && isNewRecord.time" class="badge bg-success ms-2 animate__animated animate__pulse">NEW!</span>
                </span>
              </div>
            </div>
          </div>
          <ng-template #noRecords>
            <div class="text-center py-3">
              <p class="no-records text-muted mb-0">
                <i class="fas fa-trophy text-warning me-2"></i>
                Complete a puzzle to set your first record!
              </p>
            </div>
          </ng-template>
          <div class="text-center mt-3">
            <button class="btn btn-outline-danger btn-sm" (click)="clearLeaderboard()" title="Clear all records">
              <i class="fas fa-trash-alt me-1"></i>Clear Records
            </button>
          </div>
        </div>
      </div>
    </div>


  </div>
</div>
